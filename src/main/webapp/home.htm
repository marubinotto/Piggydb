<table cellpadding="0" cellspacing="0" width="100%" border="0">
<tr>
<td class="fragments" valign="top">
<script type="text/javascript">
//<![CDATA[
	var vertical = true;

	function setVerticalLayout() {
		if (vertical) return; else vertical = true;
	
		jQuery("#page-fragments").css("display", "block");
		jQuery("#page-fragments > div").css("display", "block");
		jQuery("#page-fragments-main").css({
			"border-right-style": "none",
			"width": "auto"
		});
		jQuery("#page-fragments-main-resizable").resizable("destroy");
	}

	function setHorizontalLayout() {
		if (vertical) vertical = false; else return;
		
		jQuery("#page-fragments").css("display", "table");
		jQuery("#page-fragments").css("table-layout", "fixed");
		jQuery("#page-fragments > div").css("display", "table-cell");
		jQuery("#page-fragments-main").css("border-right", "2px dotted #ccc");
		jQuery("#page-fragments-main-resizable")
			.css({
				"padding-right": 8
			})
			.resizable({
				handles: "e",
				resize: function(event, ui) {
					var width = ui.element.width();
					jQuery("#page-fragments-main").width(width + 8);
				}
    	});
		jQuery("#page-fragments-sub").css("padding-left", 8);
			
		jQuery("#page-fragments-main").width(450);
	}
	
	function updateLayout() {
		if (jQuery("#page-fragments").width() < 900) {
			setVerticalLayout();
		}
		else {
			setHorizontalLayout();
		}
	}

  jQuery(function() {
		updateLayout();
    jQuery(window).resize(function() {
			updateLayout();
		});
  });
//]]>
</script>
<div id="page-fragments">
	
<div id="page-fragments-main">
<div id="page-fragments-main-resizable">
	
## user fragment
#if ($userFragment)
<div class="fragment-group-control">
  <img class="home-icon" src="$context/style/images/tag-user.png" border="0"
    title="$messages.get("user-home")" alt="$messages.get("user-home")"/>
</div>
<div class="user-fragment">
	#fragmentFullFledged($userFragment)
</div>
#end

## home fragments
#if ($homeFragments.totalSize > 0)
<div class="fragment-group-control">
  #set ($toggleState = $utils.getWithDefault($session, "state.home-toggle", "shown"))
  <script type="text/javascript">
  //<![CDATA[
    jQuery(function() {
      new piggydb.widget.ShowHideToggle("home-toggle", jQuery(".home-fragments"));
    });
  //]]>
  </script>
  <img class="home-icon" src="$context/style/images/tag-home.png" border="0"
    title="$messages.get("home")" alt="$messages.get("home")"/>
  #verticalShowHideToggle("home-toggle" $toggleState)
</div>
<div class="home-fragments"#if($toggleState == "hidden") style="display: none;"#end>
#homeFragments($homeFragments "hpi")
</div>
#end

</div>
</div>

<div id="page-fragments-sub">
#fragmentsView("fragmentsByDate" "$context/partial/fragments-by-date.htm#if($date)?date=$date#end" "true")
</div>

</div>
</td>
  
<td class="sidebar" align="left" valign="top">
#adSidebarTop()

#sidebarEntryHeader("sidebar-calendar" 
	$messages.get("HomePage-calendar") 
	"$context/images/date.png" 
	$null
	"")   
$utils.raw($calendarIndex)
#sidebarEntryFooter()

#commonSidebarEntries()

#adSidebarBottom()
</td>
</tr>
</table>

